# Generated by Django 6.0.1 on 2026-02-02 14:54

import django.core.validators
import django.db.models.deletion
import pgvector.django.vector
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('chat', '0005_chatmessage_full_english_version_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.AlterModelOptions(
            name='memory',
            options={'ordering': ['-last_mentioned'], 'verbose_name_plural': 'Memories'},
        ),
        migrations.AddField(
            model_name='memory',
            name='error_category',
            field=models.CharField(blank=True, help_text='grammar_tense, vocabulary, pronunciation, word_order', max_length=50),
        ),
        migrations.AddField(
            model_name='memory',
            name='frequency',
            field=models.IntegerField(default=1, help_text='Скільки разів згадувалось'),
        ),
        migrations.AddField(
            model_name='memory',
            name='last_mentioned',
            field=models.DateTimeField(auto_now=True),
        ),
        migrations.AddField(
            model_name='memory',
            name='memory_type',
            field=models.CharField(choices=[('error', 'Типова помилка'), ('mastered', 'Освоєний навик'), ('interest', 'Інтерес'), ('goal', 'Ціль'), ('progress', 'Прогрес')], default='interest', max_length=20),
        ),
        migrations.CreateModel(
            name='Module',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255, verbose_name='Назва модуля')),
                ('description', models.TextField(blank=True, verbose_name='Опис модуля')),
                ('level', models.CharField(choices=[('A0', 'Starter'), ('A1', 'Elementary'), ('A2', 'Pre-Intermediate'), ('B1', 'Intermediate'), ('B2', 'Upper-Intermediate'), ('C1', 'Advanced'), ('C2', 'Proficiency')], max_length=2, verbose_name='Рівень CEFR')),
                ('module_number', models.IntegerField(verbose_name='Номер модуля в рівні')),
                ('total_lessons', models.IntegerField(default=0, verbose_name='Кількість уроків')),
                ('estimated_duration_weeks', models.IntegerField(default=2, verbose_name='Очікувана тривалість (тижні)')),
                ('learning_objectives', models.JSONField(blank=True, default=list, help_text='Список цілей навчання (JSON array)')),
                ('is_active', models.BooleanField(default=True)),
                ('is_premium_only', models.BooleanField(default=True, verbose_name='Тільки для преміум')),
                ('order', models.IntegerField(default=0, help_text='Порядок сортування')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Модуль',
                'verbose_name_plural': 'Модулі',
                'ordering': ['level', 'module_number'],
                'unique_together': {('level', 'module_number')},
            },
        ),
        migrations.CreateModel(
            name='Lesson',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('lesson_number', models.IntegerField(verbose_name='Номер уроку')),
                ('title', models.CharField(max_length=255, verbose_name='Тема уроку')),
                ('description', models.TextField(blank=True, verbose_name='Опис уроку')),
                ('grammar_focus', models.TextField(blank=True, help_text="Наприклад: 'Verb to be, Greetings'", verbose_name='Фокус граматики')),
                ('vocabulary_list', models.JSONField(blank=True, default=list, help_text='JSON array слів для вивчення', verbose_name='Список слів')),
                ('vocabulary_count', models.IntegerField(default=0, verbose_name='Кількість слів для вивчення')),
                ('theory_content', models.TextField(blank=True, help_text='Може бути в Markdown форматі', verbose_name='Теоретичний матеріал')),
                ('theory_video_url', models.URLField(blank=True, verbose_name='Відео урок (Cloudinary URL)')),
                ('voice_practice_type', models.CharField(blank=True, help_text="Наприклад: 'Drill', 'Q&A', 'Story Chain', 'Shadowing'", max_length=100, verbose_name='Тип голосової практики')),
                ('voice_practice_instructions', models.TextField(blank=True, verbose_name='Інструкції для голосової практики')),
                ('voice_practice_prompts', models.JSONField(blank=True, default=list, help_text='Список промптів для генерації AI діалогу', verbose_name='Промпти для AI')),
                ('role_play_scenario_name', models.CharField(blank=True, help_text="Наприклад: 'Coffee Shop Encounter', 'The Lost Tourist'", max_length=255, verbose_name='Назва сценарію')),
                ('role_play_scenario', models.JSONField(blank=True, default=dict, help_text="JSON: {'setting': 'опис місця', 'ai_role': 'роль AI', 'user_role': 'роль користувача', 'objectives': [], 'difficulty': 'easy/medium/hard'}", verbose_name='Сценарій рольової гри')),
                ('homework_description', models.TextField(blank=True, verbose_name='Опис домашнього завдання')),
                ('homework_instructions', models.JSONField(blank=True, default=dict, help_text='Критерії оцінювання домашнього завдання', verbose_name='Інструкції для AI перевірки')),
                ('estimated_duration_minutes', models.IntegerField(default=60, verbose_name='Очікувана тривалість (хвилини)')),
                ('difficulty_level', models.CharField(choices=[('beginner', 'Початковий'), ('intermediate', 'Середній'), ('advanced', 'Складний')], default='beginner', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('order', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('knowledge_base_items', models.ManyToManyField(blank=True, related_name='lessons', to='chat.knowledgebase', verbose_name="Зв'язані матеріали Knowledge Base")),
                ('module', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lessons', to='chat.module', verbose_name='Модуль')),
            ],
            options={
                'verbose_name': 'Урок',
                'verbose_name_plural': 'Уроки',
                'ordering': ['module', 'lesson_number'],
                'unique_together': {('module', 'lesson_number')},
            },
        ),
        migrations.CreateModel(
            name='PronunciationAttempt',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('audio_url', models.URLField(verbose_name='Аудіо запис користувача')),
                ('target_text', models.TextField(verbose_name='Цільова фраза для вимови')),
                ('transcribed_text', models.TextField(blank=True, verbose_name='Розпізнаний текст (STT)')),
                ('pronunciation_score', models.FloatField(blank=True, help_text='Оцінка вимови (0-100)', null=True, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(100.0)])),
                ('accuracy_score', models.FloatField(blank=True, help_text='Точність слів', null=True)),
                ('fluency_score', models.FloatField(blank=True, help_text='Плавність мовлення', null=True)),
                ('pronunciation_analysis', models.JSONField(blank=True, default=dict, help_text="JSON: {'phonemes': [], 'words': [], 'improvements': []}")),
                ('topic', models.CharField(max_length=255)),
                ('content', models.TextField()),
                ('embedding', pgvector.django.vector.VectorField(blank=True, dimensions=768, null=True)),
                ('image', models.ImageField(blank=True, null=True, upload_to='knowledge_images/')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('lesson', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='pronunciation_attempts', to='chat.lesson')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='pronunciation_attempts', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Спроба вимови',
                'verbose_name_plural': 'Спроби вимови',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='RolePlaySession',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('scenario_name', models.CharField(max_length=255)),
                ('session_number', models.IntegerField(default=1)),
                ('dialogue', models.JSONField(default=list, help_text="JSON: [{'role': 'user'/'ai', 'content': 'текст', 'timestamp': 'ISO datetime', 'audio_url': 'optional'}]")),
                ('ai_evaluation', models.JSONField(blank=True, default=dict, help_text='JSON з оцінками: grammar_score, vocabulary_score, fluency_score, overall_score, strengths, improvements, feedback')),
                ('overall_score', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(10.0)])),
                ('status', models.CharField(choices=[('active', 'Активна'), ('completed', 'Завершена'), ('abandoned', 'Покинута')], default='active', max_length=20)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('duration_minutes', models.IntegerField(default=0)),
                ('messages_count', models.IntegerField(default=0)),
                ('user_messages_count', models.IntegerField(default=0)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='roleplay_sessions', to='chat.lesson')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='roleplay_sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Сесія рольової гри',
                'verbose_name_plural': 'Сесії рольових ігор',
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='UserLessonProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('not_started', 'Не розпочато'), ('in_progress', 'В процесі'), ('completed', 'Завершено'), ('mastered', 'Освоєно')], default='not_started', max_length=20)),
                ('theory_completed', models.BooleanField(default=False)),
                ('voice_practice_completed', models.BooleanField(default=False)),
                ('role_play_completed', models.BooleanField(default=False)),
                ('homework_completed', models.BooleanField(default=False)),
                ('voice_practice_score', models.FloatField(blank=True, help_text='Оцінка за голосову практику (0-10)', null=True, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(10.0)])),
                ('role_play_score', models.FloatField(blank=True, help_text='Оцінка за рольову гру (0-10)', null=True, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(10.0)])),
                ('homework_score', models.FloatField(blank=True, help_text='Оцінка за домашнє завдання (0-10)', null=True, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(10.0)])),
                ('overall_score', models.FloatField(blank=True, help_text='Загальна оцінка за урок (0-10)', null=True, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(10.0)])),
                ('attempts_count', models.IntegerField(default=0)),
                ('ai_feedback', models.JSONField(blank=True, default=dict, help_text="Зворотний зв'язок від AI по компонентах уроку")),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('last_activity', models.DateTimeField(auto_now=True)),
                ('time_spent_minutes', models.IntegerField(default=0)),
                ('lesson', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_progress', to='chat.lesson')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lesson_progress', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Прогрес по уроку',
                'verbose_name_plural': 'Прогрес по урокам',
                'ordering': ['-last_activity'],
                'unique_together': {('user', 'lesson')},
            },
        ),
        migrations.CreateModel(
            name='UserModuleProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('locked', 'Заблоковано'), ('available', 'Доступно'), ('in_progress', 'В процесі'), ('completed', 'Завершено')], default='locked', max_length=20)),
                ('lessons_total', models.IntegerField(default=0)),
                ('lessons_completed', models.IntegerField(default=0)),
                ('progress_percentage', models.FloatField(default=0.0, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(100.0)])),
                ('average_score', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(10.0)])),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('module', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_progress', to='chat.module')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='module_progress', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Прогрес по модулю',
                'verbose_name_plural': 'Прогрес по модулях',
                'ordering': ['module__level', 'module__module_number'],
                'unique_together': {('user', 'module')},
            },
        ),
    ]
