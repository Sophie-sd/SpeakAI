{# Universal partial for action buttons - used by all templates #}
{# Context variables: phase, corrected_text, full_english_version, user_message, explanation, session_id, send_url, target_id #}

{% if phase == "initial" and corrected_text and not full_english_version %}
    <div class="chat-action-buttons">
        <button class="btn-action" 
                hx-post="{{ send_url }}" 
                hx-vals='{"content": "[ACTION: explain_detailed_ua]\n–ü–æ—Ç–æ—á–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: {% if user_message %}{{ user_message|escapejs|truncatewords:50 }}{% endif %}", "session_id": "{{ session_id }}"}'
                hx-target="{% if target_id %}{{ target_id }}{% else %}#chat-history{% endif %}" 
                hx-swap="beforeend">
            <span class="icon">üá∫üá¶</span> –ü–æ—è—Å–Ω–∏—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ
        </button>
        <button class="btn-action" 
                hx-post="{{ send_url }}" 
                hx-vals='{"content": "[ACTION: explain_detailed_en]\nCurrent message: {% if user_message %}{{ user_message|escapejs|truncatewords:50 }}{% endif %}", "session_id": "{{ session_id }}"}'
                hx-target="{% if target_id %}{{ target_id }}{% else %}#chat-history{% endif %}" 
                hx-swap="beforeend">
            <span class="icon">üá¨üáß</span> Detail in English
        </button>
        <button class="btn-action secondary" 
                hx-post="{{ send_url }}" 
                hx-vals='{"content": "[ACTION: practice_task]\n–û—Ä–∏–≥—ñ–Ω–∞–ª: {% if user_message %}{{ user_message|escapejs }}{% endif %}\n–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: {{ corrected_text|escapejs }}\n–ü–æ–º–∏–ª–∫–∞: {% if explanation %}{{ explanation|escapejs|truncatewords:30 }}{% else %}–≥—Ä–∞–º–∞—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞{% endif %}", "session_id": "{{ session_id }}"}'
                hx-target="{% if target_id %}{{ target_id }}{% else %}#chat-history{% endif %}" 
                hx-swap="beforeend">
            –ü—Ä–æ–π—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è
        </button>
    </div>
{% elif phase == "detailed_explanation" and corrected_text and not full_english_version %}
    <div class="chat-action-buttons">
        <button class="btn-action primary" 
                hx-post="{{ send_url }}" 
                hx-vals='{"content": "[ACTION: continue_lesson]", "session_id": "{{ session_id }}"}'
                hx-target="{% if target_id %}{{ target_id }}{% else %}#chat-history{% endif %}" 
                hx-swap="beforeend">
            –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ —É—Ä–æ–∫
        </button>
        <button class="btn-action secondary" 
                hx-post="{{ send_url }}" 
                hx-vals='{"content": "[ACTION: practice_task]\n–û—Ä–∏–≥—ñ–Ω–∞–ª: {% if user_message %}{{ user_message|escapejs }}{% endif %}\n–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: {{ corrected_text|escapejs }}\n–ü–æ–º–∏–ª–∫–∞: {% if explanation %}{{ explanation|escapejs|truncatewords:30 }}{% else %}–≥—Ä–∞–º–∞—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞{% endif %}", "session_id": "{{ session_id }}"}'
                hx-target="{% if target_id %}{{ target_id }}{% else %}#chat-history{% endif %}" 
                hx-swap="beforeend">
            –ü—Ä–æ–π—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è
        </button>
    </div>
{% elif phase == "practice" and corrected_text and not full_english_version %}
    <div class="chat-action-buttons">
        <button class="btn-action secondary" 
                hx-post="{{ send_url }}" 
                hx-vals='{"content": "[ACTION: practice_task]\n–û—Ä–∏–≥—ñ–Ω–∞–ª: {% if user_message %}{{ user_message|escapejs }}{% endif %}\n–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: {{ corrected_text|escapejs }}\n–ü–æ–º–∏–ª–∫–∞: {% if explanation %}{{ explanation|escapejs|truncatewords:30 }}{% else %}–≥—Ä–∞–º–∞—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞{% endif %}", "session_id": "{{ session_id }}"}'
                hx-target="{% if target_id %}{{ target_id }}{% else %}#chat-history{% endif %}" 
                hx-swap="beforeend">
            –©–µ –∑–∞–≤–¥–∞–Ω–Ω—è
        </button>
        <button class="btn-action primary" 
                hx-post="{{ send_url }}" 
                hx-vals='{"content": "[ACTION: continue_lesson]", "session_id": "{{ session_id }}"}'
                hx-target="{% if target_id %}{{ target_id }}{% else %}#chat-history{% endif %}" 
                hx-swap="beforeend">
            –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ —É—Ä–æ–∫
        </button>
    </div>
{% elif phase == "initial" and full_english_version %}
    {# Mixed language input - no action buttons needed (translation and full_english_version blocks are shown) #}
{% elif phase == "initial" %}
    {# No correction needed - user wrote correctly in English #}
{% elif phase == "detailed_explanation" %}
    {# No correction needed for this phase #}
{% elif phase == "practice" %}
    {# No correction needed for this phase #}
{% endif %}
