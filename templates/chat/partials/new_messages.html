<div class="message-wrapper sent">
    <div class="avatar">–Ø</div>
    <div class="message sent">
        <div class="content">{{ user_message.content|linebreaksbr }}</div>
        <div class="meta">
            <span class="time">{{ user_message.created_at|date:"H:i" }}</span>
            <span class="status">
                <svg class="status-icon" viewBox="0 0 24 24">
                    <path d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z" />
                </svg>
            </span>
        </div>
    </div>
</div>

<div class="message-wrapper">
    <div class="avatar received-avatar">A</div>
    <div class="message received">
        <div class="content">{{ ai_message.content|linebreaksbr }}</div>
        
        {# Translation block #}
        {% if ai_message.translation %}
            <div class="translation-block translation-block-hidden" id="translation-{{ ai_message.id }}">
                <div class="translation-divider"></div>
                <div class="translation-content">{{ ai_message.translation|linebreaksbr }}</div>
            </div>
            <button type="button" class="btn-translation" data-translation-target="{{ ai_message.id }}">
                <span class="icon">üåê</span> <span class="text">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥</span>
            </button>
        {% endif %}

        {# Full English version block (for mixed language input) #}
        {% if ai_message.full_english_version %}
            <div class="full-english-block">
                <div class="correction-header">
                    <span class="icon">üí¨</span> –Ø–∫ —Ü–µ —Å–∫–∞–∑–∞—Ç–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é:
                </div>
                <div class="correction-content">{{ ai_message.full_english_version|linebreaksbr }}</div>
            </div>
        {% endif %}

        {# Correction block (for pure English with errors) #}
        {% if ai_message.corrected_text %}
            <div class="correction-block" data-original-message="{{ user_message.content|escapejs }}">
                <div class="correction-header">
                    <span class="icon">üìù</span> –Ø–∫ —Ü–µ —Å–∫–∞–∑–∞—Ç–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é:
                </div>
                <div class="correction-content">{{ ai_message.corrected_text|linebreaksbr }}</div>
            </div>
        {% endif %}

        {# Explanation block #}
        {% if ai_message.explanation %}
            <div class="explanation-block">
                <div class="explanation-header">
                    <span class="icon">üí°</span> –ü–æ—è—Å–Ω–µ–Ω–Ω—è:
                </div>
                <div class="explanation-content">{{ ai_message.explanation|linebreaksbr }}</div>
            </div>
        {% endif %}

        {# Action buttons #}
        {% include 'chat/partials/action_buttons.html' with phase=ai_message.transcript corrected_text=ai_message.corrected_text full_english_version=ai_message.full_english_version user_message=user_message.content explanation=ai_message.explanation session_id=ai_message.session.id send_url=send_message_url %}

        {# Image block #}
        {% if ai_message.image_shown %}
            <img src="{{ ai_message.image_shown.image.url }}" alt="{{ ai_message.image_shown.topic }}" class="message-image">
        {% endif %}
        <div class="meta">
            <span class="time">{{ ai_message.created_at|date:"H:i" }}</span>
        </div>
    </div>
</div>
